require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumSupport = require('appium-support');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('xcode @skip-linux', function () {
  var _this = this;

  // on slow machines and busy CI systems these can be slow and flakey
  this.timeout(30000);

  it('should get the path to xcode executable', function callee$1$0() {
    var path;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 2:
          path = context$2$0.sent;

          should.exist(path);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('getVersion', function () {
    var versionRE = /\d\.\d\.*\d*/;

    it('should get the version of xcode', function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the path and version again, these values are cached', function callee$2$0() {
      var before, path, after, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 4:
            before = new Date();
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 7:
            path = context$3$0.sent;
            after = new Date();

            should.exist(path);
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

          case 12:
            (after - before).should.be.at.most(2);

            before = new Date();
            context$3$0.next = 16;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 16:
            version = context$3$0.sent;

            after = new Date();

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];
            (after - before).should.be.at.most(2);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the parsed version', function callee$2$0() {
      var nonParsedVersion, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            nonParsedVersion = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 5:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version.versionString).should.be['true'];
            version.versionString.should.eql(nonParsedVersion);

            parseFloat(version.versionFloat).should.equal(version.versionFloat);
            parseInt(version.major, 10).should.equal(version.major);
            parseInt(version.minor, 10).should.equal(version.minor);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  it('should get the command line tools version', function callee$1$0() {
    var cliVersion;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getCommandLineToolsVersion());

        case 2:
          cliVersion = context$2$0.sent;

          _lodash2['default'].isString(cliVersion).should.be['true'];

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should clear the cache if asked to', function callee$1$0() {
    var before, after;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          _index2['default'].clearInternalCache();

          before = new Date();
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 4:
          after = new Date();

          (after - before).should.be.at.least(6);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get max iOS SDK version', function callee$1$0() {
    var version;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getMaxIOSSDK());

        case 2:
          version = context$2$0.sent;

          should.exist(version);
          (typeof version).should.equal('string');
          (parseFloat(version) - 6.1).should.be.at.least(0);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get max tvOS SDK version', function callee$1$0() {
    var version;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getMaxTVOSSDK());

        case 2:
          version = context$2$0.sent;

          should.exist(version);
          (typeof version).should.equal('string');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get a list of devices', function callee$1$0() {
    var devices;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getConnectedDevices());

        case 2:
          devices = context$2$0.sent;

          should.exist(devices);
          (typeof devices).should.equal('object');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get the path to instruments binary', function callee$1$0() {
    var instrumentsPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getInstrumentsPath());

        case 2:
          instrumentsPath = context$2$0.sent;

          should.exist(instrumentsPath);
          (typeof instrumentsPath).should.equal('string');
          instrumentsPath.length.should.be.above(3);
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(instrumentsPath));

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('ui automation', function () {
    var _this2 = this;

    before(function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 2:
            version = context$3$0.sent;

            if (version.major >= 8) {
              this.skip();
            }

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should find the automation trace template', function callee$2$0() {
      var path, suffix;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getAutomationTraceTemplatePath());

          case 2:
            path = context$3$0.sent;

            should.exist(path);
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path).should.eventually.be['true']);

          case 6:
            suffix = ".tracetemplate";

            path.slice(-suffix.length).should.equal(suffix);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,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QVEsQ0FBQyxDQUFDO0FBQ2hELHlCQUFlLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzsyQ0FDcEMsa0JBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQzs7Ozs7OztHQUNqQyxDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFZOzs7QUFDcEMsVUFBTSxDQUFDO1VBQ0QsT0FBTzs7Ozs7NkNBQVMsbUJBQU0sVUFBVSxDQUFDLElBQUksQ0FBQzs7O0FBQXRDLG1CQUFPOztBQUNYLGdCQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksQ0FBQyxFQUFFO0FBQ3RCLGtCQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDYjs7Ozs7OztLQUNGLENBQUMsQ0FBQztBQUNILE1BQUUsQ0FBQywyQ0FBMkMsRUFBRTtVQUMxQyxJQUFJLEVBSUosTUFBTTs7Ozs7NkNBSk8sbUJBQU0sOEJBQThCLEVBQUU7OztBQUFuRCxnQkFBSTs7QUFFUixrQkFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzs7NkNBQ2Isa0JBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFLOzs7QUFDM0Msa0JBQU0sR0FBRyxnQkFBZ0I7O0FBQzdCLGdCQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7Ozs7Ozs7S0FDakQsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QveGNvZGUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHhjb2RlIGZyb20gJy4uL2luZGV4JztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5cbmxldCBzaG91bGQgPSBjaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgneGNvZGUgQHNraXAtbGludXgnLCBmdW5jdGlvbiAoKSB7XG4gIC8vIG9uIHNsb3cgbWFjaGluZXMgYW5kIGJ1c3kgQ0kgc3lzdGVtcyB0aGVzZSBjYW4gYmUgc2xvdyBhbmQgZmxha2V5XG4gIHRoaXMudGltZW91dCgzMDAwMCk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggdG8geGNvZGUgZXhlY3V0YWJsZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgcGF0aCA9IGF3YWl0IHhjb2RlLmdldFBhdGgoKTtcbiAgICBzaG91bGQuZXhpc3QocGF0aCk7XG4gICAgYXdhaXQgZnMuZXhpc3RzKHBhdGgpO1xuXG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRWZXJzaW9uJywgKCkgPT4ge1xuICAgIGxldCB2ZXJzaW9uUkUgPSAvXFxkXFwuXFxkXFwuKlxcZCovO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHZlcnNpb24gb2YgeGNvZGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24oKTtcbiAgICAgIHNob3VsZC5leGlzdCh2ZXJzaW9uKTtcbiAgICAgIF8uaXNTdHJpbmcodmVyc2lvbikuc2hvdWxkLmJlLnRydWU7XG4gICAgICB2ZXJzaW9uUkUudGVzdCh2ZXJzaW9uKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBwYXRoIGFuZCB2ZXJzaW9uIGFnYWluLCB0aGVzZSB2YWx1ZXMgYXJlIGNhY2hlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IHhjb2RlLmdldFBhdGgoKTtcbiAgICAgIGF3YWl0IHhjb2RlLmdldFZlcnNpb24oKTtcblxuICAgICAgbGV0IGJlZm9yZSA9IG5ldyBEYXRlKCk7XG4gICAgICBsZXQgcGF0aCA9IGF3YWl0IHhjb2RlLmdldFBhdGgoKTtcbiAgICAgIGxldCBhZnRlciA9IG5ldyBEYXRlKCk7XG5cbiAgICAgIHNob3VsZC5leGlzdChwYXRoKTtcbiAgICAgIGF3YWl0IGZzLmV4aXN0cyhwYXRoKTtcbiAgICAgIChhZnRlci1iZWZvcmUpLnNob3VsZC5iZS5hdC5tb3N0KDIpO1xuXG4gICAgICBiZWZvcmUgPSBuZXcgRGF0ZSgpO1xuICAgICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKCk7XG4gICAgICBhZnRlciA9IG5ldyBEYXRlKCk7XG5cbiAgICAgIHNob3VsZC5leGlzdCh2ZXJzaW9uKTtcbiAgICAgIF8uaXNTdHJpbmcodmVyc2lvbikuc2hvdWxkLmJlLnRydWU7XG4gICAgICB2ZXJzaW9uUkUudGVzdCh2ZXJzaW9uKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIChhZnRlci1iZWZvcmUpLnNob3VsZC5iZS5hdC5tb3N0KDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhcnNlZCB2ZXJzaW9uJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IG5vblBhcnNlZFZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKCk7XG4gICAgICBsZXQgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24odHJ1ZSk7XG4gICAgICBzaG91bGQuZXhpc3QodmVyc2lvbik7XG4gICAgICBfLmlzU3RyaW5nKHZlcnNpb24udmVyc2lvblN0cmluZykuc2hvdWxkLmJlLnRydWU7XG4gICAgICB2ZXJzaW9uLnZlcnNpb25TdHJpbmcuc2hvdWxkLmVxbChub25QYXJzZWRWZXJzaW9uKTtcblxuICAgICAgcGFyc2VGbG9hdCh2ZXJzaW9uLnZlcnNpb25GbG9hdCkuc2hvdWxkLmVxdWFsKHZlcnNpb24udmVyc2lvbkZsb2F0KTtcbiAgICAgIHBhcnNlSW50KHZlcnNpb24ubWFqb3IsIDEwKS5zaG91bGQuZXF1YWwodmVyc2lvbi5tYWpvcik7XG4gICAgICBwYXJzZUludCh2ZXJzaW9uLm1pbm9yLCAxMCkuc2hvdWxkLmVxdWFsKHZlcnNpb24ubWlub3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCB0aGUgY29tbWFuZCBsaW5lIHRvb2xzIHZlcnNpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNsaVZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRDb21tYW5kTGluZVRvb2xzVmVyc2lvbigpO1xuICAgIF8uaXNTdHJpbmcoY2xpVmVyc2lvbikuc2hvdWxkLmJlLnRydWU7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY2xlYXIgdGhlIGNhY2hlIGlmIGFza2VkIHRvJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIHhjb2RlLmNsZWFySW50ZXJuYWxDYWNoZSgpO1xuXG4gICAgbGV0IGJlZm9yZSA9IG5ldyBEYXRlKCk7XG4gICAgYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgIGxldCBhZnRlciA9IG5ldyBEYXRlKCk7XG4gICAgKGFmdGVyLWJlZm9yZSkuc2hvdWxkLmJlLmF0LmxlYXN0KDYpO1xuXG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZ2V0IG1heCBpT1MgU0RLIHZlcnNpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcblxuICAgIHNob3VsZC5leGlzdCh2ZXJzaW9uKTtcbiAgICAodHlwZW9mIHZlcnNpb24pLnNob3VsZC5lcXVhbCgnc3RyaW5nJyk7XG4gICAgKHBhcnNlRmxvYXQodmVyc2lvbiktNi4xKS5zaG91bGQuYmUuYXQubGVhc3QoMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZ2V0IG1heCB0dk9TIFNESyB2ZXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0TWF4VFZPU1NESygpO1xuXG4gICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICh0eXBlb2YgdmVyc2lvbikuc2hvdWxkLmVxdWFsKCdzdHJpbmcnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgYSBsaXN0IG9mIGRldmljZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGRldmljZXMgPSBhd2FpdCB4Y29kZS5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XG4gICAgc2hvdWxkLmV4aXN0KGRldmljZXMpO1xuICAgICh0eXBlb2YgZGV2aWNlcykuc2hvdWxkLmVxdWFsKCdvYmplY3QnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggdG8gaW5zdHJ1bWVudHMgYmluYXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBpbnN0cnVtZW50c1BhdGggPSBhd2FpdCB4Y29kZS5nZXRJbnN0cnVtZW50c1BhdGgoKTtcblxuICAgIHNob3VsZC5leGlzdChpbnN0cnVtZW50c1BhdGgpO1xuICAgICh0eXBlb2YgaW5zdHJ1bWVudHNQYXRoKS5zaG91bGQuZXF1YWwoJ3N0cmluZycpO1xuICAgIGluc3RydW1lbnRzUGF0aC5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDMpO1xuICAgIGF3YWl0IGZzLmV4aXN0cyhpbnN0cnVtZW50c1BhdGgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndWkgYXV0b21hdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKHRydWUpO1xuICAgICAgaWYgKHZlcnNpb24ubWFqb3IgPj0gOCkge1xuICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZpbmQgdGhlIGF1dG9tYXRpb24gdHJhY2UgdGVtcGxhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcGF0aCA9IGF3YWl0IHhjb2RlLmdldEF1dG9tYXRpb25UcmFjZVRlbXBsYXRlUGF0aCgpO1xuXG4gICAgICBzaG91bGQuZXhpc3QocGF0aCk7XG4gICAgICBhd2FpdCBmcy5leGlzdHMocGF0aCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICAgIGxldCBzdWZmaXggPSBcIi50cmFjZXRlbXBsYXRlXCI7XG4gICAgICBwYXRoLnNsaWNlKC1zdWZmaXgubGVuZ3RoKS5zaG91bGQuZXF1YWwoc3VmZml4KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
